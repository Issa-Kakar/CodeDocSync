============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.4.1, pluggy-1.6.0 -- C:\Users\issak\CodeDocSync\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\issak\CodeDocSync
configfile: pyproject.toml
plugins: anyio-4.9.0, asyncio-1.1.0, mock-3.14.1
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 38 items

tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_initialization PASSED [  2%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_initialization_with_style PASSED [  5%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_simple_types PASSED [  7%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_empty_type PASSED [ 10%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_optional_types PASSED [ 13%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_union_types PASSED [ 15%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_generic_types PASSED [ 18%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_complex_types FAILED [ 21%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_normalize_type_string PASSED [ 23%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_assess_complexity FAILED [ 26%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_for_numpy_style PASSED [ 28%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_for_sphinx_style PASSED [ 31%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_split_union_types PASSED [ 34%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_extract_from_ast_name PASSED [ 36%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_extract_from_ast_attribute PASSED [ 39%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_extract_from_ast_subscript PASSED [ 42%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_extract_from_ast_none PASSED [ 44%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_simplify_for_style PASSED [ 47%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_type_mappings_numpy PASSED [ 50%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_type_mappings_sphinx PASSED [ 52%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_caching_behavior PASSED [ 55%]
tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_new_style_union_syntax FAILED [ 57%]
tests/suggestions/test_type_formatter.py::TestComplexTypeScenarios::test_deeply_nested_generics PASSED [ 60%]
tests/suggestions/test_type_formatter.py::TestComplexTypeScenarios::test_very_long_type_annotations FAILED [ 63%]
tests/suggestions/test_type_formatter.py::TestComplexTypeScenarios::test_recursive_type_structures PASSED [ 65%]
tests/suggestions/test_type_formatter.py::TestComplexTypeScenarios::test_malformed_type_annotations PASSED [ 68%]
tests/suggestions/test_type_formatter.py::TestComplexTypeScenarios::test_custom_generic_types PASSED [ 71%]
tests/suggestions/test_type_formatter.py::TestComplexTypeScenarios::test_forward_references PASSED [ 73%]
tests/suggestions/test_type_formatter.py::TestComplexTypeScenarios::test_special_typing_constructs PASSED [ 76%]
tests/suggestions/test_type_formatter.py::TestConvenienceFunctions::test_format_type_for_style_function PASSED [ 78%]
tests/suggestions/test_type_formatter.py::TestConvenienceFunctions::test_extract_type_from_ast_function PASSED [ 81%]
tests/suggestions/test_type_formatter.py::TestConvenienceFunctions::test_convenience_function_with_empty PASSED [ 84%]
tests/suggestions/test_type_formatter.py::TestPerformanceAndEdgeCases::test_cache_performance PASSED [ 86%]
tests/suggestions/test_type_formatter.py::TestPerformanceAndEdgeCases::test_unicode_in_type_annotations PASSED [ 89%]
tests/suggestions/test_type_formatter.py::TestPerformanceAndEdgeCases::test_very_long_type_names PASSED [ 92%]
tests/suggestions/test_type_formatter.py::TestPerformanceAndEdgeCases::test_special_characters_in_types PASSED [ 94%]
tests/suggestions/test_type_formatter.py::TestPerformanceAndEdgeCases::test_empty_and_whitespace_types PASSED [ 97%]
tests/suggestions/test_type_formatter.py::TestPerformanceAndEdgeCases::test_complexity_cache_size PASSED [100%]

================================== FAILURES ===================================
____________ TestTypeAnnotationFormatter.test_format_complex_types ____________

self = <tests.suggestions.test_type_formatter.TestTypeAnnotationFormatter object at 0x000001A96C958850>
google_formatter = <codedocsync.suggestions.type_formatter.TypeAnnotationFormatter object at 0x000001A96C939040>

    def test_format_complex_types(self, google_formatter: Any) -> None:
        """Test formatting of complex types."""
        # Callable should be simplified
>       assert (
            google_formatter.format_for_docstring("Callable[[int, str], bool]")
            == "callable"
        )
E       AssertionError: assert 'Callable[[int, str], bool]' == 'callable'
E
E         - callable
E         + Callable[[int, str], bool]

tests\suggestions\test_type_formatter.py:102: AssertionError
_____________ TestTypeAnnotationFormatter.test_assess_complexity ______________

self = <tests.suggestions.test_type_formatter.TestTypeAnnotationFormatter object at 0x000001A96C78F3E0>
google_formatter = <codedocsync.suggestions.type_formatter.TypeAnnotationFormatter object at 0x000001A96C958B50>

    def test_assess_complexity(self, google_formatter: Any) -> None:
        """Test complexity assessment."""
        # Simple types
        assert google_formatter._assess_complexity("str") == TypeComplexity.SIMPLE
        assert google_formatter._assess_complexity("int") == TypeComplexity.SIMPLE

        # Generic types
        assert (
            google_formatter._assess_complexity("List[str]") == TypeComplexity.GENERIC
        )
        assert (
            google_formatter._assess_complexity("Dict[str, Any]")
            == TypeComplexity.GENERIC
        )

        # Union types
        assert (
            google_formatter._assess_complexity("Union[str, int]")
            == TypeComplexity.UNION
        )
        assert (
            google_formatter._assess_complexity("Optional[str]") == TypeComplexity.UNION
        )

        # Complex types
>       assert (
            google_formatter._assess_complexity("Callable[[int], str]")
            == TypeComplexity.COMPLEX
        )
E       AssertionError: assert <TypeComplexity.GENERIC: 'generic'> == <TypeComplexity.COMPLEX: 'complex'>
E        +  where <TypeComplexity.GENERIC: 'generic'> = _assess_complexity('Callable[[int], str]')
E        +    where _assess_complexity = <codedocsync.suggestions.type_formatter.TypeAnnotationFormatter object at 0x000001A96C958B50>._assess_complexity
E        +  and   <TypeComplexity.COMPLEX: 'complex'> = TypeComplexity.COMPLEX

tests\suggestions\test_type_formatter.py:152: AssertionError
___________ TestTypeAnnotationFormatter.test_new_style_union_syntax ___________

self = <tests.suggestions.test_type_formatter.TestTypeAnnotationFormatter object at 0x000001A96C985150>
google_formatter = <codedocsync.suggestions.type_formatter.TypeAnnotationFormatter object at 0x000001A96C9911C0>

    def test_new_style_union_syntax(self, google_formatter: Any) -> None:
        """Test Python 3.10+ union syntax (Union[A, B])."""
        result = google_formatter.format_for_docstring("Union[str, int]")
        assert result == "str or int"

        result = google_formatter.format_for_docstring("Union[str, int] | float")
>       assert result == "str or int or float"
E       AssertionError: assert 'str or int' == 'str or int or float'
E
E         - str or int or float
E         + str or int

tests\suggestions\test_type_formatter.py:265: AssertionError
__________ TestComplexTypeScenarios.test_very_long_type_annotations ___________

self = <tests.suggestions.test_type_formatter.TestComplexTypeScenarios object at 0x000001A96C94CB90>
formatter = <codedocsync.suggestions.type_formatter.TypeAnnotationFormatter object at 0x000001A96C986F50>

    def test_very_long_type_annotations(self, formatter: Any) -> None:
        """Test very long type annotations."""
        long_type = "Callable[[Dict[str, List[Tuple[int, str]]], Union[List[Dict[str, Any]], None]]"
        result = formatter.format_for_docstring(long_type)
        # Should be simplified to "callable"
>       assert result == "callable"
E       AssertionError: assert 'Callable[[Di...Any]], None]]' == 'callable'
E
E         - callable
E         + Callable[[Dict[str, List[Tuple[int, str]]], Union[List[Dict[str, Any]], None]]

tests\suggestions\test_type_formatter.py:289: AssertionError
=========================== short test summary info ===========================
FAILED tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_format_complex_types
FAILED tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_assess_complexity
FAILED tests/suggestions/test_type_formatter.py::TestTypeAnnotationFormatter::test_new_style_union_syntax
FAILED tests/suggestions/test_type_formatter.py::TestComplexTypeScenarios::test_very_long_type_annotations
======================== 4 failed, 34 passed in 3.91s =========================
