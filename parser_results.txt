============================= test session starts =============================
platform win32 -- Python 3.13.5, pytest-8.4.1, pluggy-1.6.0 -- C:\Users\issak\CodeDocSync\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\issak\CodeDocSync
configfile: pyproject.toml
plugins: anyio-4.9.0, asyncio-1.1.0, mock-3.14.1
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 77 items

tests/parser/test_ast_parser_comprehensive.py::TestASTParserPerformance::test_parse_medium_file_under_50ms PASSED [  1%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserPerformance::test_parse_large_file_under_200ms PASSED [  2%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserPerformance::test_memory_usage_per_function_under_50kb PASSED [  3%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserCorrectness::test_parse_regular_functions PASSED [  5%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserCorrectness::test_parse_async_functions PASSED [  6%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserCorrectness::test_parse_generator_functions PASSED [  7%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserCorrectness::test_parse_lambda_in_functions PASSED [  9%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserComplexSignatures::test_parse_all_parameter_types PASSED [ 10%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserComplexSignatures::test_parse_complex_type_annotations PASSED [ 11%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserComplexSignatures::test_parse_variadic_parameters PASSED [ 12%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserDecorators::test_parse_multiple_decorators PASSED [ 14%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserDecorators::test_parse_class_method_decorators PASSED [ 15%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserDecorators::test_parse_decorator_with_complex_args PASSED [ 16%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserNestedStructures::test_parse_nested_functions PASSED [ 18%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserNestedStructures::test_parse_nested_classes PASSED [ 19%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserNestedStructures::test_parse_async_nested_functions PASSED [ 20%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserErrorRecovery::test_syntax_error_recovery PASSED [ 22%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserErrorRecovery::test_empty_file_handling PASSED [ 23%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserErrorRecovery::test_unicode_content PASSED [ 24%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserErrorRecovery::test_file_not_found PASSED [ 25%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserErrorRecovery::test_imports_only_file PASSED [ 27%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserSpecialCases::test_parse_property_getters_setters PASSED [ 28%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserSpecialCases::test_parse_dunder_methods PASSED [ 29%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserSpecialCases::test_parse_abstract_methods PASSED [ 31%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserSpecialCases::test_parse_yield_from PASSED [ 32%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserIntegration::test_complex_real_world_function PASSED [ 33%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserIntegration::test_async_context_managers PASSED [ 35%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserIntegration::test_dataclass_methods PASSED [ 36%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserIntegration::test_lazy_parsing_performance PASSED [ 37%]
tests/parser/test_ast_parser_comprehensive.py::TestASTParserIntegration::test_caching_improves_performance PASSED [ 38%]
tests/parser/test_ast_parser_decorators.py::TestASTParserDecorators::test_parse_single_decorator PASSED [ 40%]
tests/parser/test_ast_parser_decorators.py::TestASTParserDecorators::test_parse_multiple_decorators PASSED [ 41%]
tests/parser/test_ast_parser_decorators.py::TestASTParserDecorators::test_parse_decorator_with_arguments FAILED [ 42%]
tests/parser/test_ast_parser_decorators.py::TestASTParserDecorators::test_parse_class_decorators PASSED [ 44%]
tests/parser/test_ast_parser_decorators.py::TestASTParserDecorators::test_parse_nested_classes_and_functions PASSED [ 45%]
tests/parser/test_ast_parser_decorators.py::TestASTParserDecorators::test_parse_decorated_async_functions PASSED [ 46%]
tests/parser/test_ast_parser_decorators.py::TestASTParserDecorators::test_edge_cases PASSED [ 48%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_file_with_syntax_errors PASSED [ 49%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_partial_file PASSED [ 50%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_unicode_content PASSED [ 51%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_empty_file PASSED [ 53%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_imports_only_file PASSED [ 54%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_file_not_found PASSED [ 55%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_permission_denied PASSED [ 57%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_invalid_encoding PASSED [ 58%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_file_with_only_comments PASSED [ 59%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_file_with_mixed_content PASSED [ 61%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_lazy_parser_with_errors PASSED [ 62%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_file_with_nested_functions PASSED [ 63%]
tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_file_with_lambda_in_defaults FAILED [ 64%]
tests/parser/test_ast_parser_function_types.py::TestASTParserFunctionTypes::test_parse_regular_functions PASSED [ 66%]
tests/parser/test_ast_parser_function_types.py::TestASTParserFunctionTypes::test_parse_async_functions PASSED [ 67%]
tests/parser/test_ast_parser_function_types.py::TestASTParserFunctionTypes::test_parse_generator_functions PASSED [ 68%]
tests/parser/test_ast_parser_function_types.py::TestASTParserFunctionTypes::test_parse_lambda_functions PASSED [ 70%]
tests/parser/test_ast_parser_function_types.py::TestASTParserFunctionTypes::test_parse_nested_functions PASSED [ 71%]
tests/parser/test_ast_parser_function_types.py::TestASTParserFunctionTypes::test_parse_class_methods PASSED [ 72%]
tests/parser/test_ast_parser_performance.py::TestASTParserPerformance::test_parse_medium_file_under_50ms PASSED [ 74%]
tests/parser/test_ast_parser_performance.py::TestASTParserPerformance::test_parse_large_file_performance PASSED [ 75%]
tests/parser/test_ast_parser_performance.py::TestASTParserPerformance::test_memory_usage_per_function PASSED [ 76%]
tests/parser/test_ast_parser_performance.py::TestASTParserPerformance::test_lazy_parsing_memory_efficiency PASSED [ 77%]
tests/parser/test_ast_parser_performance.py::TestASTParserPerformance::test_incremental_parsing_performance PASSED [ 79%]
tests/parser/test_ast_parser_performance.py::TestASTParserPerformance::test_caching_performance_improvement PASSED [ 80%]
tests/parser/test_docstring_parser_integration.py::TestFormatDetection::test_auto_detect_google_style PASSED [ 81%]
tests/parser/test_docstring_parser_integration.py::TestFormatDetection::test_auto_detect_numpy_style PASSED [ 83%]
tests/parser/test_docstring_parser_integration.py::TestFormatDetection::test_auto_detect_sphinx_style PASSED [ 84%]
tests/parser/test_docstring_parser_integration.py::TestFormatDetection::test_auto_detect_rest_style PASSED [ 85%]
tests/parser/test_docstring_parser_integration.py::TestExtractionAccuracy::test_extract_all_param_info PASSED [ 87%]
tests/parser/test_docstring_parser_integration.py::TestExtractionAccuracy::test_extract_returns_section PASSED [ 88%]
tests/parser/test_docstring_parser_integration.py::TestExtractionAccuracy::test_extract_raises_section PASSED [ 89%]
tests/parser/test_docstring_parser_integration.py::TestExtractionAccuracy::test_preserve_examples_section PASSED [ 90%]
tests/parser/test_docstring_parser_integration.py::TestExtractionAccuracy::test_handle_malformed_docstrings PASSED [ 92%]
tests/parser/test_docstring_parser_integration.py::TestExtractionAccuracy::test_extract_complex_types PASSED [ 93%]
tests/parser/test_docstring_parser_integration.py::TestExtractionAccuracy::test_optional_parameters_with_defaults PASSED [ 94%]
tests/parser/test_docstring_parser_integration.py::TestMixedFormats::test_mixed_format_handling PASSED [ 96%]
tests/parser/test_docstring_parser_integration.py::TestPerformance::test_parse_time_performance PASSED [ 97%]
tests/parser/test_docstring_parser_integration.py::TestPerformance::test_batch_parsing_performance PASSED [ 98%]
tests/parser/test_docstring_parser_integration.py::TestEdgeCases::test_unicode_and_special_characters PASSED [100%]

================================== FAILURES ===================================
_________ TestASTParserDecorators.test_parse_decorator_with_arguments _________

self = <tests.parser.test_ast_parser_decorators.TestASTParserDecorators object at 0x00000235C2997950>

        def test_parse_decorator_with_arguments(self) -> None:
            """Test parsing decorators with arguments."""
            with tempfile.NamedTemporaryFile(mode="w", suffix=".py", delete=False) as f:
                f.write(
                    '''
    import functools
    from typing import Any, List, Optional

    @decorator_with_args("string_arg", 42, keyword=True)
    def func1():
        """Function with decorator arguments."""
        pass

    @functools.lru_cache(maxsize=None)
    def func2(n: int) -> int:
        """LRU cache with None maxsize."""
        return n * 2

    @retry(max_attempts=3, delay=1.5, exceptions=(ValueError, TypeError))
    def func3(data: dict) -> Optional[str]:
        """Retry decorator with multiple arguments."""
        return data.get("key")

    @app.route("/api/users", methods=["GET", "POST"])
    def api_endpoint():
        """Flask-style route decorator."""
        return {"status": "ok"}

    @validate_schema(
        input_schema=UserSchema,
        output_schema=ResponseSchema,
        strict=True
    )
    def func4(user_data: dict) -> dict:
        """Decorator with multiline arguments."""
        return {"id": 1, **user_data}
    '''
                )
                f.flush()

                try:
                    functions = parse_python_file(f.name)

                    # Should find 5 functions
                    assert len(functions) == 5

                    # Check func1
                    func1 = functions[0]
                    assert func1.signature.name == "func1"
                    assert len(func1.signature.decorators) == 1
                    assert (
                        func1.signature.decorators[0]
                        == "decorator_with_args('string_arg', 42, keyword=True)"
                    )

                    # Check func2
                    func2 = functions[1]
                    assert func2.signature.name == "func2"
                    assert (
                        func2.signature.decorators[0] == "functools.lru_cache(maxsize=None)"
                    )

                    # Check func3
                    func3 = functions[2]
                    assert func3.signature.name == "func3"
                    assert (
                        func3.signature.decorators[0]
                        == "retry(max_attempts=3, delay=1.5, exceptions=(ValueError, TypeError))"
                    )

                    # Check api_endpoint
                    api_func = functions[3]
                    assert api_func.signature.name == "api_endpoint"
>                   assert (
                        api_func.signature.decorators[0]
                        == 'app.route("/api/users", methods=["GET", "POST"])'
                    )
E                   assert "app.route('/...ET', 'POST'])" == 'app.route("/...ET", "POST"])'
E
E                     - app.route("/api/users", methods=["GET", "POST"])
E                     ?           ^          ^           ^   ^  ^    ^
E                     + app.route('/api/users', methods=['GET', 'POST'])
E                     ?           ^          ^           ^   ^  ^    ^

tests\parser\test_ast_parser_decorators.py:211: AssertionError
_____ TestASTParserErrorRecovery.test_parse_file_with_lambda_in_defaults ______

self = <tests.parser.test_ast_parser_error_recovery.TestASTParserErrorRecovery object at 0x00000235C2AF4210>

        def test_parse_file_with_lambda_in_defaults(self) -> None:
            """Test parsing functions with lambda expressions in default values."""
            with tempfile.NamedTemporaryFile(
                mode="w", suffix=".py", delete=False, encoding="utf-8"
            ) as f:
                f.write(
                    """
    def function_with_lambda_default(
        callback=lambda x: x * 2,
        data_processor=lambda data: [d.upper() for d in data]
    ):
        '''Function with lambda default values.'''
        return callback(10)

    def function_with_complex_defaults(
        list_default=[1, 2, 3],
        dict_default={"key": "value"},
        callable_default=print
    ):
        '''Function with various complex default values.'''
        pass
    """
                )
                temp_path = f.name

            try:
                functions = parse_python_file(temp_path)
                assert len(functions) == 2

                # Check lambda defaults
                lambda_func = functions[0]
                assert lambda_func.signature.name == "function_with_lambda_default"
                params = lambda_func.signature.parameters
                assert params[0].default_value == "lambda x: x * 2"
                assert params[1].default_value == "lambda data: [d.upper() for d in data]"

                # Check complex defaults
                complex_func = functions[1]
                assert complex_func.signature.name == "function_with_complex_defaults"
                params = complex_func.signature.parameters
                # Parser gives full expressions, not simplified
                assert params[0].default_value is not None
                assert "[1, 2, 3]" in params[0].default_value
                assert params[1].default_value is not None
>               assert "{'a': 1, 'b': 2}" in params[1].default_value
E               assert "{'a': 1, 'b': 2}" in "{'key': 'value'}"
E                +  where "{'key': 'value'}" = FunctionParameter(name='dict_default', type_annotation=None, default_value="{'key': 'value'}", is_required=False).default_value

tests\parser\test_ast_parser_error_recovery.py:447: AssertionError
=========================== short test summary info ===========================
FAILED tests/parser/test_ast_parser_decorators.py::TestASTParserDecorators::test_parse_decorator_with_arguments
FAILED tests/parser/test_ast_parser_error_recovery.py::TestASTParserErrorRecovery::test_parse_file_with_lambda_in_defaults
======================== 2 failed, 75 passed in 7.37s =========================
